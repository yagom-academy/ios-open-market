# ğŸª Open Market ğŸª
<br>

## ğŸ“œ ëª©ì°¨
1. [ì†Œê°œ](#-ì†Œê°œ)
2. [ê°œë°œí™˜ê²½ ë° ë¼ì´ë¸ŒëŸ¬ë¦¬](#-ê°œë°œí™˜ê²½-ë°-ë¼ì´ë¸ŒëŸ¬ë¦¬)
3. [íŒ€ì›](#-íŒ€ì›)
4. [íƒ€ì„ë¼ì¸](#-íƒ€ì„ë¼ì¸)
5. [UML](#-UML)
6. [ì‹¤í–‰í™”ë©´](#-ì‹¤í–‰-í™”ë©´)
7. [íŠ¸ëŸ¬ë¸” ìŠˆíŒ… ë° ê³ ë¯¼](#-íŠ¸ëŸ¬ë¸”-ìŠˆíŒ…-ë°-ê³ ë¯¼)
8. [ì°¸ê³ ë§í¬](#-ì°¸ê³ -ë§í¬)

<br>

## ğŸ—£ ì†Œê°œ
[AyaanğŸ¦–](https://github.com/oneStar92), [ì¤€í˜¸](https://github.com/junho15) ì˜ ê°„ë‹¨í•œ ë§ˆì¼“ê¸°ëŠ¥ì„ ì´ìš©í•  ìˆ˜ ìˆëŠ” í”„ë¡œì íŠ¸ ì…ë‹ˆë‹¤.
Mordern Collection View í™œìš©í•˜ì—¬ LISTì™€ GRID í˜•íƒœë¡œ ìƒí’ˆ ëª©ë¡ í™”ë©´ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.

***ê°œë°œ ê¸°ê°„ : 2022-11-14 ~ 2022-11-25***

<br>

## ğŸ’» ê°œë°œí™˜ê²½ ë° ë¼ì´ë¸ŒëŸ¬ë¦¬
[![iOS](https://img.shields.io/badge/iOS_Deployment_Target-14.0-blue)]()
[![swift](https://img.shields.io/badge/Xcode_Compatible-9.3-orange)]()

<br>

## ğŸ§‘ íŒ€ì›
|Ayaan|ì¤€í˜¸|
|:---:|:---:|
|<img src= "https://i.imgur.com/Unq1bdd.png" width ="200"/>|<img src = "https://camo.githubusercontent.com/a482a55a5f5456520d73f6c2debdd13375430060d5d1613ca0c733853dedacc0/68747470733a2f2f692e696d6775722e636f6d2f436558554f49642e706e67" width=200 height=200>|

<br>

## ğŸ•– íƒ€ì„ë¼ì¸

### Step 1

- 2022.11.14
    - Page Type êµ¬í˜„
    - Product Type êµ¬í˜„
    - Currency Type êµ¬í˜„
- 2022.11.15
    - Page Unit Test
    - OpenMarket APIì™€ ë„¤íŠ¸ì›Œí¬ êµ¬í˜„
        - OpenMarket API Health ì¡°íšŒ
        - OpenMarket API ìƒí’ˆ ë¦¬ìŠ¤íŠ¸ ì¡°íšŒ
        - OpenMarket API ìƒí’ˆ ìƒì„¸ ì¡°íšŒ
    - ProductImage Type êµ¬í˜„
    - Vendor Type êµ¬í˜„
- 2022.11.16
    - ë„¤íŠ¸ì›Œí¬ ê¸°ëŠ¥ í”„ë¡œí† ì½œí™”
    - Test Doubleì„ í†µí•´ êµ¬í˜„ëœ ë„¤íŠ¸ì›Œí¬ Test
        - RequestedDummyData êµ¬í˜„
        - StubURLSession êµ¬í˜„
        - StubURLSessionDataTask êµ¬í˜„
        - FakeURLSession êµ¬í˜„
- 2022.11.19
    - OpenMarketError Typeì— errorDescription ê¸°ëŠ¥ 
    
### Step 2 

- 2022.11.22
    - ProductListCell êµ¬í˜„
    - OpenMarketCollectionView êµ¬í˜„
    - ProductGridCell êµ¬í˜„
    - SegmentedControl êµ¬í˜„
    - Image Cache êµ¬í˜„
    - ìƒí’ˆ ë“±ë¡ ë²„íŠ¼ êµ¬í˜„
    - ë¡œë”©ì°½ êµ¬í˜„
- 2022.11.23
    - Image Cache êµ¬í˜„
    - ìƒí’ˆ ë“±ë¡ ë²„íŠ¼ êµ¬í˜„
    - ë¡œë”©ì°½ êµ¬í˜„
- 2022.11.25
    - GridLayout ê°€ë³€ ë†’ì´ êµ¬í˜„

<br>

## ğŸ“Š UML

### Model

<img src="https://i.imgur.com/YSomJuD.jpg" width="500">

### URLSession Protocol

<img src="https://i.imgur.com/oVURD58.jpg">

<br>

## ğŸ’» ì‹¤í–‰ í™”ë©´



|List|Grid|
|:---:|:---:|
|<img src="https://i.imgur.com/zbf016U.gif" width="400">|<img src="https://i.imgur.com/OmFmQEU.gif" width="400">|

|LIST GRID ì „í™˜|
|:---:|
|<img src="https://i.imgur.com/sm69aR6.gif" width="400" height = "450">|

<br>

## ğŸ¯ íŠ¸ëŸ¬ë¸” ìŠˆíŒ… ë° ê³ ë¯¼

### Decodable Model Property Optional
|ìƒí’ˆ ë¦¬ìŠ¤íŠ¸ ì¡°íšŒì‹œ ì•„ì´í…œ|ìƒí’ˆ ìƒì„¸ ì¡°íšŒì‹œ ì•„ì´í…œ|
|:---:|:---:|
|![](https://i.imgur.com/mnpGzkb.png)|![](https://i.imgur.com/GfPoqcb.png)|

- OpenMarket APIì—ì„œ ìƒí’ˆ ë¦¬ìŠ¤íŠ¸ ì¡°íšŒì‹œ ì „ë‹¬ë˜ëŠ” ì•„ì´í…œê³¼ ì™€ ìƒí’ˆ ìƒì„¸ ì¡°íšŒì‹œ ì „ë‹¬ë˜ëŠ” ì•„ì´í…œì˜ í”„ë¡œí¼í‹°ê°€ ì„œë¡œ ë‹¬ë¼ì„œ í•˜ë‚˜ì˜ Modelë¡œëŠ” ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ëŠ” ë¬¸ì œê°€ ìˆì—ˆìŠµë‹ˆë‹¤.
- êµ¬í˜„ëœ Modelì—ì„œ ì„œë¡œ ìƒì´í•œ ë¶€ë¶„ì„ Optionalë¡œ ì§€ì •í•´ ì¤Œìœ¼ë¡œì¨ í•´ë‹¹ ë¬¸ì œë¥¼ í•´ê²°í–ˆìŠµë‹ˆë‹¤.

<details>
<summary>ì½”ë“œ ë³´ê¸°</summary>
<div markdown="1">
    
```swift
    struct Product: Decodable {
        let id, vendorID: Int
        let name, thumbnail: String
        let description: String? // ì˜µì…”ë„ íƒ€ì…
        let currency: Currency
        let price, bargainPrice, discountedPrice: Double
        let stock: Int
        let createdAt, issuedAt: String
        let images: [ProductImage]? // ì˜µì…”ë„ íƒ€ì…
        let vendor: Vendor? // ì˜µì…”ë„ íƒ€ì…
```
    
</div>
</details>

<br>

### API í†µì‹  ê¸°ëŠ¥ë³„ Protocolí™”
- URLSessionì— API í†µì‹ ê³¼ ê´€ë ¨ëœ ê¸°ëŠ¥ì„ extensionì„ í†µí•´ êµ¬í˜„í–ˆì—ˆìŠµë‹ˆë‹¤. POPì˜ ê´€ì ì—ì„œ êµ¬í˜„í•´ ë³´ê³ ìí•˜ì—¬ ê¸°ëŠ¥ë³„ë¡œ í”„ë¡œí† ì½œì„ ë§Œë“¤ì–´ì„œ `URLSession` ì´ ì±„íƒí•˜ë„ë¡ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.

<details>
<summary>ì½”ë“œ ë³´ê¸°</summary>
<div markdown="1">
    
```swift
    extension URLSession: OpenMarketURLSessionProtocol { }
    extension URLSession: OpenMarketHealthFetchable { }
    extension URLSession: OpenMarketPageFetchable { }
    extension URLSession: OpenMarketProductFetchable { }
```
    
</div>
</details>

<br>

### ì¤‘ë³µëœ Guardë¬¸

- URLSessionDataTaskì˜ CompletionHandlerì—ì„œ data, response, errorì— ë”°ë¥¸ ë¶„ê¸°ì²˜ë¦¬ë¥¼ í•´ì£¼ì§€ ì•Šê³  dataë¥¼ ì²˜ë¦¬í•˜ëŠ” ë¡œì§ì—ì„œ guardë¬¸ì„ ì´ìš©í•´ ë¶„ê¸°ì²˜ë¦¬ë¥¼ í•´ì¤Œìœ¼ë¡œì¨ ì¤‘ë³µëœ ì½”ë“œê°€ ë°œìƒí•˜ëŠ” ë¶€ë¶„ì´ ìˆì—ˆìŠµë‹ˆë‹¤.
- URLSessionDataTaskì˜ CompletionHandlerì—ì„œ if letì„ ì´ìš©í•˜ì—¬ ë¶„ê¸° ì²˜ë¦¬ë¥¼ í•´ì£¼ì–´ ì¤‘ë³µëœ ì½”ë“œë¥¼ ì¤„ì¼ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

<details>
<summary>ì½”ë“œ ë³´ê¸°</summary>
<div markdown="1">
    
```swift
    // ìˆ˜ì • ì „
    private func fetchOpenMarketAPIDataTask(query: String,
                                            completion: @escaping (Data?, URLResponse?, Error?) -> Void) -> URLSessionDataTask {
        guard let hostURL = URL(string: "https://openmarket.yagom-academy.kr"),
              let url = URL(string: query, relativeTo: hostURL) else {
            fatalError()
        }
        
        return self.dataTask(with: url) { (data, response, error) in
            guard let data = data, error == nil else {
                completion(nil, response, error)
                return
            }
            completion(data, response, nil)
        }
    }

    func checkHealthTask(completion: @escaping (Bool) -> Void) {
        let query: String = "healthChecker"
        fetchOpenMarketAPIDataTask(query: query) { (_, response, error) in
            // ì¤‘ë³µëœ ì½”ë“œ ë°œìƒ êµ¬ê°„
            guard error == nil, let httpResponse = response as? HTTPURLResponse,
                  httpResponse.statusCode == 200 else {
                completion(false)
                return
            }
            // ëª¨ë“  ë¡œì§ì—ì„œ í•´ë‹¹ ì½”ë“œê°€ ì¡´ì¬.
            completion(true)
        }.resume()
    }

    // ìˆ˜ì • í›„
    func fetchOpenMarketDataTask(query: String,
                                 completion: @escaping (Data?, Error?) -> Void) -> URLSessionDataTask? {
        guard let hostURL = URL(string: host),
              let url = URL(string: query, relativeTo: hostURL) else {
            return nil
        }
        
        return self.dataTask(with: url) { (data, response, error) in
            if let error = error {
                completion(nil, error)
            } else if (response as? HTTPURLResponse)?.statusCode != 200 {
                completion(nil, OpenMarketError.badStatus)
            } else if let data = data {
                completion(data, nil)
            } else {
                completion(nil, nil)
            }
        }
    }


    func fetchHealth(completion: @escaping (OpenMarketHealth) -> Void) {
        let query: String = "healthChecker"
        
        fetchOpenMarketDataTask(query: query) { (data, error) in
            if let error = error {
                print(error.localizedDescription)
                completion(.bad)
            } else if data != nil {
                completion(.ok)
            } else {
                completion(.bad)
            }
        }?.resume()
    }

```
    
</div>
</details>

<br>

### List Cell AutoLayout
|Before|After|Before|After|
|:---:|:---:|:---:|:---:|
|<img src= "https://i.imgur.com/1tkjlgI.png" width ="200"/>|<img src= "https://i.imgur.com/Mat0GIj.png" width ="200"/>|<img src= "https://i.imgur.com/HXruN8b.png" width ="200"/>|<img src= "https://i.imgur.com/Md9GgSX.png" width ="200"/>|

- Viewê°€ ìµœì´ˆë¡œ ë¡œë“œëì„ ë•Œ CollectionView Auto Layoutì´ ë­‰ê²Œì§€ëŠ” í˜„ìƒê³¼ ê°€ë¡œ ì„¸ë¡œ ëª¨ë“œ ì „í™˜ì‹œ ë·°ì˜ í¬ê¸°ê°€ ë³€í•¨ì— ë”°ë¼ Cellì˜ í¬ê¸°ê°€ ìë™ì ìœ¼ë¡œ ë³€í™”í•˜ì§€ ì•ŠëŠ” ê²½ìš°ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.
- `collectionView.autoresizingMask = [.flexibleWidth, .flexibleHeight]`ì™€ Constraintì˜ `priority` ë° `StackView`ë¥¼ ì´ìš©í•´ì„œ í•´ë‹¹ ë¬¸ì œë¥¼ í•´ê²°í–ˆìŠµë‹ˆë‹¤.

<br>

### í•˜ë‚˜ì˜ Collection Viewì— ë‘ê°€ì§€ Layoutê³¼ Cellì‚¬ìš©
- ë‘ ê°œì˜ Collection Viewì— ê°ê°ì˜ Layoutê³¼ Cellì„ ë“±ë¡í•˜ê³  Segmented Controlì„ í†µí•´ì„œ CollectionViewë¥¼ ê°ì·ƒë‹¤ ë³´ì—¬ì¤«ë‹¤ë¥¼ í•˜ë ¤ê³  í–ˆìœ¼ë‚˜ ì´ëŸ¬í•œ êµ¬í˜„ë³´ë‹¤ í•œê°œì˜ Collection Viewì—ì„œ ë‘ê°œì˜ Layoutê³¼ Cellì„ ì´ìš©í•˜ê¸° ìœ„í•´ ë§ì€ ê³ ë¯¼ì´ ìˆì—ˆìŠµë‹ˆë‹¤.
- í•˜ë‚˜ì˜ Collection Viewì— ë‘ ê°œì˜ Cellì„ ë“±ë¡í•˜ê³  dequeueí• ë•Œ í˜„ì¬ ì–´ë–¤ layoutì„ ê·¸ë ¤ì•¼ í•˜ëŠ”ì§€ë¥¼ ë‹´ì€ í”„ë¡œí¼í‹°ë¥¼ ì´ìš©í•´ì„œ í•œ ê°œì˜ Collection Viewì—ì„œ ë‘ ê°œì˜ ìŠ¤íƒ€ì¼ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.

<details>
<summary>ì½”ë“œ ë³´ê¸°</summary>
<div markdown="1">
    
```swift
    // Layout ì„¤ì •
    func updateLayout(of layout: CollectionViewLayout) {
        setCollectionViewLayout(LayoutMaker.make(of: layout), animated: false)
        currentLayout = layout
    }

    // Cell ë“±ë¡
    private func registerCell() {
        listCellRegistration = UICollectionView.CellRegistration { (cell, indexPath, product) in
            cell.updateWithProduct(product)
            cell.accessories = [.disclosureIndicator()]
        }
        
        gridCellRegistration = UICollectionView.CellRegistration { (cell, indexPath, product) in
            cell.updateWithProduct(product)
        }
    }

    // cell ì¬ì‚¬ìš©
        openMarketDataSource = UICollectionViewDiffableDataSource(collectionView: self) { (collectionView: UICollectionView, indexPath: IndexPath, product: Product) -> UICollectionViewCell? in
            switch self.currentLayout {
            case .list:
                return collectionView.dequeueConfiguredReusableCell(using: listCellRegistration, for: indexPath, item: product)
            case .grid:
                return collectionView.dequeueConfiguredReusableCell(using: gridCellRegistration, for: indexPath, item: product)
            }
        }
```

</div>
</details>

<br>

### ë¡œë”©í™”ë©´
- Collection View Sectionì˜ Footerë¥¼ ì´ìš©í•˜ì—¬ ë¡œë”©í• ë•Œ ë³´ì—¬ì§ˆ Viewë¥¼ êµ¬í˜„í•˜ë ¤ê³  í–ˆìœ¼ë‚˜, UICollectionViewDataSource Protocolì„ ì´ìš©í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— Footerë¥¼ ì‚¬ìš©í•˜ëŠ”ë° ë§ì€ ë¬¸ì œê°€ ìˆì—ˆìŠµë‹ˆë‹¤.
- ë°ì´í„° ë¡œë”© ì‹œ ì „ì²´ Viewì— ì„ì˜ì˜ Viewë¥¼ ê·¸ë ¤ì£¼ê³  ëª¨ë“  ë°ì´í„°ë¥¼ ë¡œë“œí•˜ê²Œ ë˜ë©´ ì„ì˜ì˜ Viewë¥¼ ì œê±°í•˜ëŠ” ë°©ë²•ìœ¼ë¡œ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.

<details>
<summary>ìŠ¤í¬ë¦°ìƒ· ë³´ê¸°</summary>
<div markdown="1">
    
<img src= "https://i.imgur.com/CmLs9R4.png" width ="200"/>

</div>
</details>

<br>

### Grid Layout ë™ì  ë†’ì´
|Before|After|
|:---:|:---:|
|<img src= "https://i.imgur.com/HTKg16N.jpg" width ="200"/>|<img src= "https://i.imgur.com/3Gu961u.jpg" width ="200"/>|

- GridLayoutì˜ Itemê³¼ Groupì˜ ë†’ì´ë¥¼ `.fractionalHeight()`ë¡œ ì§€ì •í•´ ì£¼ê²Œ ë˜ë©´ì„œ ëª¨ë“  Cellì˜ ë†’ì´ê°€ ë™ì¼í•˜ê²Œ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ í…ìŠ¤íŠ¸ì˜ ê¸¸ì´ê°€ ê¸¸ì–´ì§€ê²Œë˜ë©´ í…ìŠ¤íŠ¸ì— ì¤„ì„ë§ í‘œì‹œê°€ ìƒê¸°ëŠ” ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.
- Itemê³¼ Groupì˜ ë†’ì´ë¥¼ `.estimated()`ë¡œ ì§€ì •í•´ ì¤Œìœ¼ë¡œ í•´ë‹¹ ë¬¸ì œë¥¼ í•´ê²°í–ˆìŠµë‹ˆë‹¤.


<br>

## ğŸ“š ì°¸ê³  ë§í¬

- [Fetching Website Data into Memory](https://developer.apple.com/documentation/foundation/url_loading_system/fetching_website_data_into_memory)
- [URLSession](https://developer.apple.com/documentation/foundation/urlsession)
- [Implementing Modern Collection Views](https://developer.apple.com/documentation/uikit/views_and_controls/collection_views/implementing_modern_collection_views)
- [UICollectionView.CellRegistration](https://developer.apple.com/documentation/uikit/uicollectionview/cellregistration)
- [UICollectionViewDiffableDataSource](https://developer.apple.com/documentation/uikit/uicollectionviewdiffabledatasource)
- [NSDiffableDataSourceSnapshot](https://developer.apple.com/documentation/uikit/nsdiffabledatasourcesnapshot)
- [UICollectionViewCompositionalLayout](https://developer.apple.com/documentation/uikit/uicollectionviewcompositionallayout)
- [NSCache](https://developer.apple.com/documentation/foundation/nscache)
- [UIActivityIndicatorView](https://developer.apple.com/documentation/uikit/uiactivityindicatorview)
